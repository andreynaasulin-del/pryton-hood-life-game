/**
 * –ü–†–û–ì–†–ï–°–° –°–Æ–ñ–ï–¢–ê –ò –ü–û–î–°–ö–ê–ó–ö–ò
 */

export class StoryProgress {
    getCurrentAct(day) {
        if (day <= 10) return { num: 1, name: '–ü–†–û–ë–£–ñ–î–ï–ù–ò–ï', color: '#10b981' };
        if (day <= 20) return { num: 2, name: '–•–ê–°–õ', color: '#f59e0b' };
        return { num: 3, name: '–§–ò–ù–ê–õ', color: '#ef4444' };
    }

    getCurrentObjective(day, state) {
        const syndicateDebt = state.syndicate;
        const cash = state.kpis?.cash || 0;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
        const nextPaymentDay = syndicateDebt?.nextPaymentDay || 3;
        const daysUntilPayment = nextPaymentDay - day;

        if (daysUntilPayment <= 1 && daysUntilPayment >= 0) {
            const needed = syndicateDebt?.currentPayment || 1500;
            if (cash < needed) {
                return {
                    icon: 'alert-circle',
                    title: '‚ö†Ô∏è –°–†–û–ß–ù–û: –ü–ª–∞—Ç—ë–∂ –∑–∞–≤—Ç—Ä–∞!',
                    desc: `–ù—É–∂–Ω–æ ${needed}‚ÇΩ. –£ —Ç–µ–±—è ${cash}‚ÇΩ.`,
                    hint: '–ó–∞—Ä–∞–±–æ—Ç–∞–π –¥–µ–Ω—å–≥–∏ –Ω–∞ —É–ª–∏—Ü–µ –∏–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ.',
                    priority: 'critical'
                };
            }
        }

        // –ö–≤–µ—Å—Ç—ã
        const activeQuests = state.quests?.active || [];
        if (activeQuests.length > 0) {
            const questId = activeQuests[0];
            const questHints = {
                'story_hustle': {
                    title: 'üí∞ –ü–µ—Ä–≤—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫',
                    desc: '–ó–∞—Ä–∞–±–æ—Ç–∞–π 300‚ÇΩ –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º.',
                    hint: '–ò–¥–∏ –Ω–∞ –£–õ–ò–¶–ê ‚Üí –†–∞–∑–¥–∞—Ç—å –ª–∏—Å—Ç–æ–≤–∫–∏'
                },
                'story_market_run': {
                    title: 'üõí –ó–∞–∫—É–ø–∫–∞',
                    desc: '–ö—É–ø–∏ –µ–¥—É –≤ –¢–µ–Ω–µ–≤–æ–º –ú–∞–≥–∞–∑–∏–Ω–µ.',
                    hint: '–ò–¥–∏ –≤ –¢–ï–ù–ï–í–û–ô –ú–ê–ì–ê–ó–ò–ù ‚Üí –£–ª–∏—Ü–∞ ‚Üí –ö—É–ø–∏ –î–æ—à–∏—Ä–∞–∫'
                },
                'story_studio_time': {
                    title: 'üé§ –ó–∞–ø–∏—Å—å —Ç—Ä–µ–∫–∞',
                    desc: '–°–¥–µ–ª–∞–π —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –¥–µ–º–æ—Å.',
                    hint: '–ò–¥–∏ –≤ –ö–õ–£–ë ‚Üí –°—Ç—É–¥–∏—è ‚Üí –ó–∞–ø–∏—Å–∞—Ç—å –¥–µ–º–æ'
                }
            };

            if (questHints[questId]) {
                return { icon: 'target', priority: 'high', ...questHints[questId] };
            }
        }

        // –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
        const upcomingEvents = {
            3: { title: 'üí∏ –î–µ–Ω—å –ø–ª–∞—Ç–µ–∂–∞', desc: '–ö–æ–ª–ª–µ–∫—Ç–æ—Ä –ø—Ä–∏–¥—ë—Ç —Å–µ–≥–æ–¥–Ω—è.' },
            5: { title: 'üéß –í—Å—Ç—Ä–µ—á–∞ —Å –ó–µ—Ñ–æ–º', desc: '–ï—Å–ª–∏ –∑–∞–ø–∏—Å–∞–ª —Ç—Ä–µ–∫ ‚Äî –ø–æ–∑–Ω–∞–∫–æ–º–∏—à—å—Å—è —Å –ø—Ä–æ–¥—é—Å–µ—Ä–æ–º.' },
            10: { title: 'üí∞ –í—Ç–æ—Ä–æ–π –ø–ª–∞—Ç—ë–∂', desc: '–ö–æ–Ω–µ—Ü –ø–µ—Ä–≤–æ–≥–æ –∞–∫—Ç–∞.' },
            17: { title: '‚ö†Ô∏è –¢—Ä–µ—Ç–∏–π –ø–ª–∞—Ç—ë–∂', desc: '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–µ.' },
            24: { title: 'üíÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞—Ç—ë–∂', desc: '–ù–µ –æ–ø–æ–∑–¥–∞–π ‚Äî —ç—Ç–æ –∫–æ–Ω–µ—Ü –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ.' },
            30: { title: 'üèÅ –§–ò–ù–ê–õ', desc: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å. –ü–æ–±–µ–¥–∞ –∏–ª–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ.' }
        };

        for (const eventDay of Object.keys(upcomingEvents).map(Number)) {
            if (day < eventDay && eventDay - day <= 3) {
                return {
                    icon: 'calendar-clock',
                    title: `–ß–µ—Ä–µ–∑ ${eventDay - day} –¥–Ω: ${upcomingEvents[eventDay].title}`,
                    desc: upcomingEvents[eventDay].desc,
                    hint: '–ì–æ—Ç–æ–≤—å—Å—è –∫ —Å–æ–±—ã—Ç–∏—é.',
                    priority: 'medium'
                };
            }
        }

        // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Ü–µ–ª—å
        return {
            icon: 'coins',
            title: 'üíµ –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–µ–Ω—å–≥–∏',
            desc: `–î–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞: ${30 - day} –¥–Ω. –î–æ–ª–≥: ${syndicateDebt?.debt || 50000}‚ÇΩ`,
            hint: '–ò—Å–ø–æ–ª—å–∑—É–π –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∫–∞.',
            priority: 'normal'
        };
    }

    getHintFromSpirit(day, state) {
        const hints = {
            1: '–°–ª—É—à–∞–π, –Ω–æ–≤–∏—á–æ–∫. –í–∏–¥–∏—à—å –≤–∏–¥–∂–µ—Ç ¬´–°–ò–ù–î–ò–ö–ê–¢¬ª —Å–ª–µ–≤–∞? –¢–∞–º —Ç–∞–π–º–µ—Ä –¥–æ –ø–ª–∞—Ç–µ–∂–∞. –ù–µ –ø—Ä–æ—Å–ø–∏.',
            2: '–õ–∏—Å—Ç–æ–≤–∫–∏ ‚Äî —ç—Ç–æ –∫–æ–ø–µ–π–∫–∏, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–π–¥—ë—Ç. –ú–æ–∂–µ—à—å —Ä–∏—Å–∫–Ω—É—Ç—å –≤ –∫–∞–∑–∏–Ω–æ, –µ—Å–ª–∏ –Ω–∞–≥–ª—ã–π.',
            3: '–ö–æ–ª–ª–µ–∫—Ç–æ—Ä —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–¥—ë—Ç. –ï—Å–ª–∏ –¥–µ–Ω–µ–≥ –Ω–µ—Ç ‚Äî –±—É–¥–µ—Ç –±–æ–ª—å–Ω–æ. –û—á–µ–Ω—å.',
            5: '–ó–∞–ø–∏—Å–∞–ª —Ç—Ä–µ–∫? –ú–æ–ª–æ–¥–µ—Ü. –¢–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–µ—Ç–∏—à—å—Å—è —Å –ó–µ—Ñ–æ–º. –û–Ω –ø–æ–º–æ–∂–µ—Ç.',
            10: '–ö–æ–Ω–µ—Ü –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–∏. –ö–∞–∫ –æ—â—É—â–µ–Ω–∏—è? –î–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç, –¥–∞?',
            15: '–•–µ–π—Ç–µ—Ä—ã –≤ —Å–µ—Ç–∏ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ò–≥–Ω–æ—Ä–∏—Ä—É–π –∏–ª–∏ –æ–≥—Ä—ã–∑–∞–π—Å—è ‚Äî —Ç–≤–æ–π –≤—ã–±–æ—Ä.',
            20: '–ê–∫—Ç –≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω—á–µ–Ω. –î–∞–ª—å—à–µ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –∂—ë—Å—Ç—á–µ.',
            25: '–û—Å—Ç–∞–ª–æ—Å—å 5 –¥–Ω–µ–π. –£ —Ç–µ–±—è –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏? –ò–ª–∏ –≥–æ—Ç–æ–≤–∏—à—å —è–º—É?',
            29: '–ó–∞–≤—Ç—Ä–∞ —Ñ–∏–Ω–∞–ª. –ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å. –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å.',
            30: '–°–µ–≥–æ–¥–Ω—è –≤—Å—ë —Ä–µ—à–∏—Ç—Å—è.'
        };

        return hints[day] || null;
    }
}

export const storyProgress = new StoryProgress();
